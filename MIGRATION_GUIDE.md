# –ö–∞–∫ –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ schema.prisma –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

## üî¥ –í–∞–∂–Ω–æ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** (–ø–æ—Ä—Ç 5432), –∞ –Ω–µ pooling (–ø–æ—Ä—Ç 6543).

## –®–∞–≥ 1: –í—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ DATABASE_URL

–í —Ñ–∞–π–ª–µ `.env` –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–µ–Ω–∏—Ç–µ `DATABASE_URL` –Ω–∞ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:

```env
# –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–π - –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–ë–ï–ó pooling)
DATABASE_URL=postgresql://postgres.hrwcwgagfxglxwerwzed:zYHvqc8D4sbfmhpL@aws-1-eu-north-1.pooler.supabase.com:5432/postgres?sslmode=require
```

‚ö†Ô∏è **–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ**: –ø–æ—Ä—Ç **5432** (–Ω–µ 6543), –ë–ï–ó `pgbouncer=true` –∏ `connection_limit=1`

## –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# –°–æ–∑–¥–∞—Å—Ç –º–∏–≥—Ä–∞—Ü–∏—é –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –µ—ë –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
npm run migrate:dev -- --name make_phone_optional
```

–ò–ª–∏:

```bash
npx prisma migrate dev --name make_phone_optional
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç SQL —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ `prisma/migrations/`
- ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏—é –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç `_prisma_migrations` —Ç–∞–±–ª–∏—Ü—É

## –®–∞–≥ 3: –í–µ—Ä–Ω–∏—Ç–µ DATABASE_URL –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤–µ—Ä–Ω–∏—Ç–µ pooling URL –≤ `.env`:

```env
# –î–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - —Å pooling (–¥–ª—è serverless)
DATABASE_URL=postgresql://postgres.hrwcwgagfxglxwerwzed:zYHvqc8D4sbfmhpL@aws-1-eu-north-1.pooler.supabase.com:6543/postgres?sslmode=require&pgbouncer=true&connection_limit=1
```

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏): db push

–ï—Å–ª–∏ –≤—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ö–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
# ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏! –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ production!
npm run prisma:push
```

‚ö†Ô∏è **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `db push` –≤ production!** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏.

---

## –ü–æ–ª–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥

```bash
# 1. –í—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ DATABASE_URL –Ω–∞ –ø–æ—Ä—Ç 5432 –≤ .env

# 2. –°–æ–∑–¥–∞–π—Ç–µ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
npm run migrate:dev -- --name –æ–ø–∏—Å–∞–Ω–∏–µ_–∏–∑–º–µ–Ω–µ–Ω–∏–π

# 3. –í–µ—Ä–Ω–∏—Ç–µ DATABASE_URL –Ω–∞ –ø–æ—Ä—Ç 6543 –≤ .env

# 4. –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Prisma Client (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
npm run prisma:generate
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
npm run migrate:status
```

---

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ?

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä), –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Prisma Client:

```bash
npm run prisma:generate
```

---

## Troubleshooting

### –û—à–∏–±–∫–∞ "Migration engine failed to connect"

‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ª–∏ –≤—ã –ø–æ—Ä—Ç **5432** (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –î–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –û—à–∏–±–∫–∞ "Database schema is not in sync"

‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç–µ:
```bash
npm run migrate:dev -- --name sync_schema
```

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
npx prisma migrate deploy --verbose
```

